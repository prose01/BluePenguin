<container *ngIf="window && window.isCollapsed">
  <div class="chat-title secondary-background">
    <div class="chat-title-visibility-toggle-area" (click)="onChatWindowClicked(window)">
      <strong title="{{window.participant.displayName}}">
        {{window.participant.displayName}}
      </strong>
      <span [ngClass]="{'chat-participant-status': true, 'online': window.participant.status == ChatParticipantStatus.Online, 'busy': window.participant.status == ChatParticipantStatus.Busy, 'away': window.participant.status == ChatParticipantStatus.Away, 'offline': window.participant.status == ChatParticipantStatus.Offline}" title="{{chatParticipantStatusDescriptor(window.participant.status, localization)}}"></span>
    </div>
    <a href="javascript:void(0);" class="chat-close primary-text" (click)="onCloseChatWindow()">X</a>
  </div>
</container>
<container *ngIf="window && !window.isCollapsed">
  <div class="chat-title secondary-background">
    <div class="chat-title-visibility-toggle-area" (click)="onChatWindowClicked(window)">
      <strong title="{{window.participant.displayName}}">
        {{window.participant.displayName}}
      </strong>
      <span [ngClass]="{'chat-participant-status': true, 'online': window.participant.status == ChatParticipantStatus.Online, 'busy': window.participant.status == ChatParticipantStatus.Busy, 'away': window.participant.status == ChatParticipantStatus.Away, 'offline': window.participant.status == ChatParticipantStatus.Offline}" title="{{chatParticipantStatusDescriptor(window.participant.status, localization)}}"></span>
    </div>
    <a href="javascript:void(0);" class="chat-close primary-text" (click)="onCloseChatWindow()">X</a>
    <chat-options [ngClass]="'chat-options-container'" [options]="defaultWindowOptions(window)" (activeOptionTrackerChange)="activeOptionTrackerChange($event)"></chat-options>
  </div>
  <div #chatMessages class="chat-messages primary-background">
    <div *ngIf="window.isLoadingHistory" class="chat-loading-wrapper">
      <div class="loader">Loading history...</div>
    </div>
    <div *ngIf="hasPagedHistory && window.hasMoreMessages && !window.isLoadingHistory" class="chat-load-history">
      <a class="load-history-action" (click)="fetchMessageHistory(window)">{{localization.loadMessageHistoryPlaceholder}}</a>
    </div>

    <div *ngFor="let message of window.messages; let i = index" [ngClass]="{'chat-message': true, 'chat-message-received': message.fromId != userId}">
      <container *ngIf="isAvatarVisible(window, message, i)">
        <div class="circle" [ngStyle]="{'background-color': message.fromId != userId ? message.fromAvatar.circleColour : currentUser.avatar.circleColour }">

          <div class="initials" [ngStyle]="{'color': message.fromId != userId ? message.fromAvatar.initialsColour : currentUser.avatar.initialsColour }">
            {{ message.fromId != userId ? message.fromAvatar.initials : currentUser.avatar.initials }}
          </div>
        </div>

        <span *ngIf="window.participant.participantType == ChatParticipantType.Group" class="chat-participant-name">{{window.participant | groupMessageDisplayName:message}}</span>
      </container>
      <container [ngSwitch]="message.type">
        <div [ngClass]="{'sent-chat-message-container': message.fromId == userId, 'received-chat-message-container': message.fromId != userId}">
          <span [innerHtml]="message.message | emojify:emojisEnabled | linkfy:linkfyEnabled"></span>
          <span *ngIf="showMessageDate && message.dateSent" class="message-sent-date">{{message.dateSent | date:messageDatePipeFormat}}</span>
        </div>
      </container>
    </div>
  </div>

  <div class="chat-footer primary-outline-color primary-background">
    <input #chatWindowInput
           type="text"
           [ngModel]="window.newMessage | emojify:emojisEnabled"
           (ngModelChange)="window.newMessage=$event"
           [placeholder]="localization.messagePlaceholder"
           [ngClass]="{'chat-window-input': true, 'has-side-action': fileUploadAdapter}"
           (keydown)="onChatInputTyped($event, window)"
           (blur)="toggleWindowFocus(window)"
           (focus)="toggleWindowFocus(window)" />
  </div>
</container>
